\documentclass[11pt,a4paper,openany]{book}

% Essential packages
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage[a4paper,margin=2cm]{geometry}
\usepackage{lmodern}
\renewcommand{\familydefault}{\sfdefault}
\usepackage{etoolbox}

% Math and physics packages
\usepackage{amsmath,amssymb,amsfonts,amsthm}
\usepackage{mathtools}
\usepackage{physics}
\usepackage{siunitx}
\sisetup{locale=DE, group-separator={.}, per-mode=symbol, output-decimal-marker={,}}

% Graphics and tables
\usepackage{graphicx}
\usepackage[table]{xcolor}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,positioning,shapes.geometric,decorations.pathmorphing,patterns,shapes.arrows,intersections}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usepackage{tcolorbox}
\usepackage{booktabs}
\usepackage{array}
\usepackage{longtable}
\usepackage{float}
\usepackage{adjustbox}

% Document formatting
\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\setlength{\headheight}{15pt}
\usepackage{tocloft}
\usepackage{hyperref}
\usepackage{bookmark}
\usepackage{cleveref}
\usepackage{microtype}
\usepackage{enumitem}
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage{multicol}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{listings}
\usepackage{mdframed}
\usepackage{pdflscape}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{braket}
\usepackage{cancel}
\usepackage{caption}
\usepackage{csquotes}
\usepackage{doi}
\usepackage{forest}
\usepackage{gensymb}
\usepackage{hyphenat}
\usepackage{textcomp}
\usepackage{textgreek}
\usepackage{upgreek}
\usepackage{url}
\usepackage{slashed}
\usepackage{bm}

% Unicode and custom chars
\usepackage{newunicodechar}

% Colors
\definecolor{blue}{rgb}{0,0,1}
\definecolor{boxgray}{RGB}{240,240,240}
\definecolor{deepblue}{RGB}{0,0,127}
\definecolor{deepgreen}{RGB}{0,127,0}
\definecolor{deepred}{RGB}{191,0,0}
\definecolor{t0blue}{RGB}{33,150,243}
\definecolor{t0green}{RGB}{76,175,80}
\definecolor{t0orange}{RGB}{255,152,0}
\definecolor{t0purple}{RGB}{156,39,176}
\definecolor{t0red}{RGB}{244,67,54}
\definecolor{t0yellow}{RGB}{255,204,0}

% hypersetup
\hypersetup{
	colorlinks=true,
	linkcolor=t0blue,
	citecolor=t0blue,
	urlcolor=t0blue,
	breaklinks=true,
	bookmarksnumbered=true,
	bookmarksopen=true,
	bookmarksopenlevel=1,
	pdfstartview=FitH,
	pdftitle={T0 Time--Mass Duality: Unified English Book}
}

% Custom commands
\newcommand{\Kfrak}{K_{\text{frak}}}
\newcommand{\Dfrak}{D_{\text{frak}}}
\newcommand{\betapar}{\beta_T}
\newcommand{\alphapar}{\alpha}
\newcommand{\Tfield}{T(x,t)}
\newcommand{\Efield}{E(x,t)}
\newcommand{\mfield}{m(x,t)}
\newcommand{\Lag}{\mathcal{L}}
\newcommand{\calL}{\mathcal{L}}
\newcommand{\alphaem}{\alpha}
\newcommand{\betaT}{\beta_T}
\newcommand{\xiT}{\xi}
\newcommand{\xipar}{\xi}
\newcommand{\Ezero}{E_0}
\newcommand{\EPlanck}{E_{\text{Pl}}}
\newcommand{\Mpl}{M_{\text{Pl}}}
\newcommand{\lP}{\ell_{\text{P}}}
\newcommand{\tP}{t_{\text{P}}}
\newcommand{\LPlanck}{\ell_{\text{Pl}}}
\newcommand{\TPlanck}{t_{\text{Pl}}}
\newcommand{\Gnat}{G_{\text{nat}}}
\newcommand{\alphaEM}{\alpha_{\text{EM}}}
\newcommand{\alphaSI}{\alpha_{\text{SI}}}
\newcommand{\Hubble}{H_0}
\newcommand{\LCDM}{\Lambda\text{CDM}}
\newcommand{\natunits}{(nat. units)}
\newcommand{\checked}{\checkmark}
\newcommand{\warningx}{\textbf{!}}

% T0 parameters
\newcommand{\xigeom}{\xi_{\mathrm{geom}}}
\newcommand{\rzero}{r_{0}}
\newcommand{\xirat}{\xi_{\mathrm{rat}}}
\newcommand{\tzero}{t_{0}}
\newcommand{\Lambdat}{\Lambda_{\mathrm{t}}}
\newcommand{\EP}{E_{\mathrm{P}}}
\newcommand{\Emu}{E_{\mu}}
\newcommand{\Ee}{E_{e}}
\newcommand{\Etau}{E_{\tau}}
\newcommand{\alphafine}{\alpha_{\mathrm{fine}}}
\newcommand{\alphal}{\alpha_{\ell}}

% Theorem environments
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}
\newtheorem{warning}[theorem]{Warning}
\newtheorem{axiom}{Axiom}
\newtheorem{principle}{Principle}
\newtheorem{insight}{Insight}
\newtheorem{discovery}{Discovery}
\newtheorem{proof_step}{Proof Step}
\newtheorem{category}{Category-Theoretic Basis}

% Unicode chars
\newunicodechar{ħ}{$\hbar$}
\newunicodechar{↔}{$\leftrightarrow$}
\newunicodechar{⇐}{$\Leftarrow$}
\newunicodechar{⇒}{$\Rightarrow$}
\newunicodechar{⇔}{$\Leftrightarrow$}
\newunicodechar{∂}{$\partial$}
\newunicodechar{∅}{$\emptyset$}
\newunicodechar{∇}{$\nabla$}
\newunicodechar{∈}{$\in$}
\newunicodechar{∉}{$\notin$}
\newunicodechar{∏}{$\prod$}
\newunicodechar{∑}{$\sum$}
\newunicodechar{√}{$\sqrt{}$}
\newunicodechar{∝}{$\propto$}
\newunicodechar{∞}{$\infty$}
\newunicodechar{∩}{$\cap$}
\newunicodechar{∪}{$\cup$}
\newunicodechar{∫}{$\int$}
\newunicodechar{≈}{$\approx$}
\newunicodechar{≠}{$\neq$}
\newunicodechar{≤}{$\leq$}
\newunicodechar{≥}{$\geq$}

% tcolorbox styles
\tcbset{
	keyresult/.style={
		colback=blue!5!white,
		colframe=blue!75!black,
		title=Key Result,
		fonttitle=\bfseries
	},
	foundation/.style={
		colback=green!5!white,
		colframe=green!75!black,
		title=Foundation,
		fonttitle=\bfseries
	},
	alternative/.style={
		colback=orange!5!white,
		colframe=orange!75!black,
		title=Alternative,
		fonttitle=\bfseries
	},
	warning/.style={
		colback=red!5!white,
		colframe=red!75!black,
		title=Warning,
		fonttitle=\bfseries
	}
}

\newtcolorbox{keyresultbox}[1][]{
	keyresult, #1
}
\newtcolorbox{foundationbox}[1][]{
	foundation, #1
}
\newtcolorbox{alternativebox}[1][]{
	alternative, #1
}
\newtcolorbox{warningbox}[1][]{
	warning, #1
}

% Layout settings
\sloppy
\hfuzz=2pt
\vfuzz=2pt

% TOC formatting
\renewcommand{\cftchapfont}{\large\bfseries\color{blue}}
\renewcommand{\cftchappagefont}{\large\bfseries\color{blue}}
\renewcommand{\cftsecfont}{\large\bfseries\color{blue}}
\renewcommand{\cftsecpagefont}{\large\bfseries\color{blue}}
\renewcommand{\cftsubsecfont}{\color{blue}}
\renewcommand{\cftsubsecpagefont}{\color{blue}}
\renewcommand{\cftsubsubsecfont}{\color{blue}}
\renewcommand{\cftsubsubsecpagefont}{\color{blue}}
\renewcommand{\cfttoctitlefont}{\huge\bfseries\color{blue}}

% Fix siunitx conflicts
\AtBeginDocument{%
	\emergencystretch=3em
}
